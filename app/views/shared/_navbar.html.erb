<%# app/views/shared/_navbar.html.erb %>
<%# Navbar mobile-first com logo central no mobile e links sem rotas quebradas %>

<% inicio_path  = nav_path(:root_path, :home_link_path, fallback: "/") %>
<% sim_path     = nav_path(:new_frete_path, :new_calculo_path, :new_simulacao_path, fallback: inicio_path) %>
<% contato_path = nav_path(:contato_path, :new_contato_path, :new_contatos_path, fallback: inicio_path) %>

<nav class="bg-gradient-to-r from-purple-900 to-purple-700 shadow-lg fixed top-0 left-0 w-full z-50">
  <div class="max-w-7xl mx-auto px-4">
    <div class="h-16 flex items-center justify-between">
      <!-- BotÃ£o menu (mobile) -->
      <div class="md:hidden flex items-center">
        <button id="cc-mobile-menu-btn" type="button"
                class="inline-flex items-center justify-center rounded-lg p-2 text-white hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/30"
                aria-controls="cc-mobile-menu" aria-expanded="false">
          <span class="sr-only">Abrir menu</span>
          <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>

      <!-- Logo (central no mobile / esquerda no desktop) -->
      <div class="flex-1 flex items-center justify-center md:justify-start">
        <%= link_to inicio_path, class: "flex items-center gap-2 text-white text-xl font-extrabold tracking-wide hover:text-purple-200 transition" do %>
          <span class="text-2xl">ðŸš›</span>
          <span>CargaClick</span>
        <% end %>
      </div>

      <!-- EspaÃ§o para alinhar logo ao centro no mobile -->
      <div class="md:hidden w-10"></div>

      <!-- Links (desktop) -->
      <div class="hidden md:flex items-center gap-2">
        <%= link_to "InÃ­cio", inicio_path, class: "px-3 py-2 rounded-lg text-sm font-semibold text-white hover:bg-white/10 #{nav_active_class(inicio_path)}" %>
        <%= link_to "Simular frete", sim_path, class: "px-3 py-2 rounded-lg text-sm font-semibold text-white hover:bg-white/10 #{nav_active_class(sim_path)}" %>

        <% if route_exists?(:fidelidade_path) %>
          <%= link_to "Fidelidade", fidelidade_path, class: "px-3 py-2 rounded-lg text-sm font-semibold text-white hover:bg-white/10 #{nav_active_class(fidelidade_path)}" %>
        <% end %>

        <%# Evita quebrar caso nÃ£o exista /sobre %>
        <% if route_exists?(:about_path) %>
          <%= link_to "Sobre", about_path, class: "px-3 py-2 rounded-lg text-sm font-semibold text-white hover:bg-white/10 #{nav_active_class(about_path)}" %>
        <% elsif route_exists?(:sobre_path) %>
          <%= link_to "Sobre", sobre_path, class: "px-3 py-2 rounded-lg text-sm font-semibold text-white hover:bg-white/10 #{nav_active_class(sobre_path)}" %>
        <% end %>

        <%= link_to "Contato", contato_path, class: "px-3 py-2 rounded-lg text-sm font-semibold text-white hover:bg-white/10 #{nav_active_class(contato_path)}" %>

        <%# BotÃµes de Ã¡rea (sem rotas Devise inexistentes). Apontam para simulaÃ§Ã£o/contato atÃ© unificar login por roles. %>
        <%= link_to "Ãrea do Cliente", sim_path, class: "ml-2 px-3 py-2 rounded-lg text-sm font-bold bg-white/15 text-white hover:bg-white/25 transition" %>
        <%= link_to "Ãrea do Transportador", contato_path, class: "px-3 py-2 rounded-lg text-sm font-bold bg-yellow-400/90 text-black hover:bg-yellow-300 transition" %>

        <%# Admin (se Devise existir) %>
        <% if route_exists?(:new_admin_user_session_path) %>
          <%= link_to "Admin", new_admin_user_session_path, class: "ml-2 px-3 py-2 rounded-lg text-sm font-semibold text-white hover:bg-white/10" %>
        <% end %>
      </div>
    </div>

    <!-- Menu mobile -->
    <div id="cc-mobile-menu" class="md:hidden hidden pb-3">
      <div class="mt-2 rounded-xl bg-white/10 backdrop-blur p-2">
        <%= link_to "InÃ­cio", inicio_path, class: "block px-3 py-2 rounded-lg text-sm font-semibold text-white hover:bg-white/10 #{nav_active_class(inicio_path)}" %>
        <%= link_to "Simular frete", sim_path, class: "block px-3 py-2 rounded-lg text-sm font-semibold text-white hover:bg-white/10 #{nav_active_class(sim_path)}" %>

        <% if route_exists?(:fidelidade_path) %>
          <%= link_to "Fidelidade", fidelidade_path, class: "block px-3 py-2 rounded-lg text-sm font-semibold text-white hover:bg-white/10 #{nav_active_class(fidelidade_path)}" %>
        <% end %>

        <% if route_exists?(:about_path) %>
          <%= link_to "Sobre", about_path, class: "block px-3 py-2 rounded-lg text-sm font-semibold text-white hover:bg-white/10 #{nav_active_class(about_path)}" %>
        <% elsif route_exists?(:sobre_path) %>
          <%= link_to "Sobre", sobre_path, class: "block px-3 py-2 rounded-lg text-sm font-semibold text-white hover:bg-white/10 #{nav_active_class(sobre_path)}" %>
        <% end %>

        <%= link_to "Contato", contato_path, class: "block px-3 py-2 rounded-lg text-sm font-semibold text-white hover:bg-white/10 #{nav_active_class(contato_path)}" %>

        <div class="mt-2 grid grid-cols-1 gap-2">
          <%= link_to "Ãrea do Cliente", sim_path, class: "w-full text-center px-3 py-2 rounded-lg text-sm font-bold bg-white/15 text-white hover:bg-white/25 transition" %>
          <%= link_to "Ãrea do Transportador", contato_path, class: "w-full text-center px-3 py-2 rounded-lg text-sm font-bold bg-yellow-400/90 text-black hover:bg-yellow-300 transition" %>
        </div>

        <% if route_exists?(:new_admin_user_session_path) %>
          <div class="mt-2">
            <%= link_to "Admin", new_admin_user_session_path, class: "block px-3 py-2 rounded-lg text-sm font-semibold text-white hover:bg-white/10" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</nav>

<script>
  (function() {
    var btn = document.getElementById('cc-mobile-menu-btn');
    var menu = document.getElementById('cc-mobile-menu');
    if (!btn || !menu) return;

    btn.addEventListener('click', function() {
      var isHidden = menu.classList.contains('hidden');
      menu.classList.toggle('hidden');
      btn.setAttribute('aria-expanded', isHidden ? 'true' : 'false');
    });
  })();
</script>
