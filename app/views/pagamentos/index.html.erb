<div class="container mx-auto p-4">
  <h1 class="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-100">
    ğŸ’³ Pagamentos
  </h1>

  <% if @pagamentos.any? %>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <% @pagamentos.each do |pagamento| %>
        <div class="bg-white dark:bg-gray-900 shadow rounded-lg p-4 flex flex-col justify-between">
          <!-- CabeÃ§alho -->
          <div>
            <p class="text-sm text-gray-500">
              Frete: <%= link_to "##{pagamento.frete_id}", frete_path(pagamento.frete), class: "underline" %>
            </p>
            <p class="text-sm text-gray-500">
              Cliente: <%= pagamento.cliente_nome || "N/A" %>
            </p>
            <p class="text-sm text-gray-500">
              Transportador: <%= pagamento.transportador_nome || "N/A" %>
            </p>
            <p class="text-lg font-semibold mt-2">
              <%= number_to_currency(pagamento.valor_total || pagamento.valor) %>
            </p>

            <% if pagamento.liberado? %>
              <p class="text-xs text-gray-500 mt-1">
                Repasse: <%= pagamento.payout_txid.present? ? pagamento.payout_txid : "N/A" %>
              </p>
            <% end %>
          </div>

          <!-- Status + AÃ§Ãµes (Turbo Stream) -->
          <div id="<%= dom_id(pagamento, :status) %>" class="mt-4">
            <span class="inline-block px-2 py-1 rounded text-xs font-bold
              <%= case pagamento.status
                  when "liberado"  then "bg-green-200 text-green-800"
                  when "escrow"    then "bg-indigo-200 text-indigo-800"
                  when "confirmado" then "bg-teal-200 text-teal-800"
                  when "pendente"  then "bg-yellow-200 text-yellow-800"
                  when "cancelado" then "bg-red-200 text-red-800"
                  when "estornado" then "bg-gray-200 text-gray-800"
                  else "bg-gray-200 text-gray-800" end %>">
              <%= pagamento.status_label %>
            </span>

            <div class="mt-3 flex flex-wrap gap-2">
              <% if pagamento.pendente? %>
                <%= button_to "Marcar como Pago (Escrow)",
                    pagamento_path(pagamento, status: "escrow"),
                    method: :patch,
                    data: { turbo_stream: true },
                    class: "px-3 py-1 bg-indigo-600 text-white rounded hover:bg-indigo-700 text-sm" %>

                <%= button_to "Cancelar",
                    pagamento_path(pagamento, status: "cancelado"),
                    method: :patch,
                    data: { turbo_stream: true, confirm: "Deseja realmente cancelar este pagamento?" },
                    class: "px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm" %>
              <% elsif pagamento.escrow? %>
                <%= button_to "Liberar repasse (Pix)",
                    liberar_pagamento_path(pagamento),
                    method: :post,
                    data: { turbo_stream: true, confirm: "Confirmar liberaÃ§Ã£o do repasse ao transportador?" },
                    class: "px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-sm" %>
              <% end %>

              <%= link_to "Visualizar",
                  pagamento_path(pagamento),
                  class: "px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm" %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="bg-yellow-50 border border-yellow-300 text-yellow-800 rounded-lg p-4">
      Nenhum pagamento registrado atÃ© o momento.
    </div>
  <% end %>
</div>
