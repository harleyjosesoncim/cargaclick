<%= turbo_stream.replace dom_id(@pagamento, :status) do %>
  <span class="inline-block px-2 py-1 rounded text-xs font-bold
    <%= case @pagamento.status
        when "liberado"  then "bg-green-200 text-green-800"
        when "escrow"    then "bg-indigo-200 text-indigo-800"
        when "confirmado" then "bg-teal-200 text-teal-800"
        when "pendente"  then "bg-yellow-200 text-yellow-800"
        when "cancelado" then "bg-red-200 text-red-800"
        when "estornado" then "bg-gray-200 text-gray-800"
        else "bg-gray-200 text-gray-800" end %>">
    <%= @pagamento.status_label %>
  </span>

  <div class="mt-3 flex flex-wrap gap-2">
    <% if @pagamento.pendente? %>
      <%= button_to "Marcar como Pago (Escrow)",
          pagamento_path(@pagamento, status: "escrow"),
          method: :patch,
          data: { turbo_stream: true },
          class: "px-3 py-1 bg-indigo-600 text-white rounded hover:bg-indigo-700 text-sm" %>

      <%= button_to "Cancelar",
          pagamento_path(@pagamento, status: "cancelado"),
          method: :patch,
          data: { turbo_stream: true, confirm: "Deseja realmente cancelar este pagamento?" },
          class: "px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm" %>
    <% elsif @pagamento.escrow? %>
      <%= button_to "Liberar repasse (Pix)",
          liberar_pagamento_path(@pagamento),
          method: :post,
          data: { turbo_stream: true, confirm: "Confirmar liberação do repasse ao transportador?" },
          class: "px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-sm" %>
    <% end %>
  </div>
<% end %>
