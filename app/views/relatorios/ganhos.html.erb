<h1 class="text-2xl font-bold mb-6">Relatório de Ganhos</h1>

<p class="text-sm text-gray-600 mb-4">
  Período:
  <strong><%= @from&.to_date %></strong>
  até
  <strong><%= @to&.to_date %></strong>
</p>

<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
  <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
    <p class="text-xs uppercase text-blue-700 font-semibold">Total movimentado</p>
    <p class="text-xl font-bold">
      <%= number_to_currency(@total_movimentado, unit: "R$ ") %>
    </p>
    <p class="text-xs text-gray-600 mt-1">
      Soma de todos os fretes pagos dentro do app.
    </p>
  </div>

  <div class="bg-green-50 border border-green-200 rounded-lg p-4">
    <p class="text-xs uppercase text-green-700 font-semibold">Repassado aos transportadores</p>
    <p class="text-xl font-bold">
      <%= number_to_currency(@total_repassado_transportadores, unit: "R$ ") %>
    </p>
    <p class="text-xs text-gray-600 mt-1">
      Valor líquido recebido pelos transportadores.
    </p>
  </div>

  <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
    <p class="text-xs uppercase text-yellow-700 font-semibold">Ganho do CargaClick</p>
    <p class="text-xl font-bold">
      <%= number_to_currency(@total_ganhos_plataforma, unit: "R$ ") %>
    </p>
    <p class="text-xs text-gray-600 mt-1">
      Comissão da plataforma (8% ou 5%, conforme fidelidade).
    </p>
  </div>
</div>

<% if @pagamentos.any? %>
  <table class="min-w-full bg-white border border-gray-200 rounded-lg overflow-hidden text-sm">
    <thead class="bg-gray-100">
      <tr>
        <th class="px-3 py-2 text-left">Data</th>
        <th class="px-3 py-2 text-left">Frete</th>
        <th class="px-3 py-2 text-left">Cliente</th>
        <th class="px-3 py-2 text-left">Transportador</th>
        <th class="px-3 py-2 text-right">Valor total</th>
        <th class="px-3 py-2 text-right">Comissão (taxa)</th>
        <th class="px-3 py-2 text-right">Líquido transportador</th>
        <th class="px-3 py-2 text-left">Status</th>
      </tr>
    </thead>
    <tbody>
      <% @pagamentos.each do |pagamento| %>
        <tr class="border-t border-gray-200 hover:bg-gray-50">
          <td class="px-3 py-2">
            <%= pagamento.created_at.strftime("%d/%m/%Y %H:%M") %>
          </td>
          <td class="px-3 py-2">
            Frete #<%= pagamento.frete_id %>
          </td>
          <td class="px-3 py-2">
            <%= pagamento.cliente_nome.presence || "-" %>
          </td>
          <td class="px-3 py-2">
            <%= pagamento.transportador_nome.presence || "-" %>
          </td>
          <td class="px-3 py-2 text-right">
            <%= number_to_currency(pagamento.valor_total, unit: "R$ ") %>
          </td>
          <td class="px-3 py-2 text-right">
            <%= number_to_currency(pagamento.comissao_cargaclick, unit: "R$ ") %>
            <% if pagamento.respond_to?(:taxa) && pagamento.taxa.present? && pagamento.taxa.to_d > 0 %>
              <span class="text-xs text-gray-600">
                (<%= (pagamento.taxa.to_d * 100).to_f.round(1) %>%)
              </span>
            <% end %>
          </td>
          <td class="px-3 py-2 text-right">
            <%= number_to_currency(pagamento.valor_liquido, unit: "R$ ") %>
          </td>
          <td class="px-3 py-2">
            <%= pagamento.status_label %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p class="text-gray-600 mt-4">
    Nenhum pagamento confirmado no período selecionado.
  </p>
<% end %>
