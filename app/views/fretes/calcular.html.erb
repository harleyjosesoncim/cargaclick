<section 
  x-data="{
    peso: '', 
    distancia: '', 
    transportador_id: '', 
    valido() {
      return this.peso > 0 && this.distancia > 0 && this.transportador_id !== '';
    }
  }" 
  class="bg-white shadow-xl rounded-2xl p-8 my-8 max-w-xl mx-auto"
>
  <h2 class="text-2xl font-bold mb-4 text-blue-700">Simular Frete</h2>

  <%= form_with url: calcular_frete_path, method: :get, local: true do %>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <!-- Peso -->
      <div>
        <%= label_tag :peso, "Peso da carga (kg)", class: "block text-sm font-medium text-gray-700" %>
        <%= number_field_tag :peso, nil, step: 0.1, 
            class: "mt-1 w-full border border-gray-300 rounded px-3 py-2 text-sm shadow-sm",
            x_model: "peso" %>
        <template x-if="peso !== '' && peso <= 0">
          <p class="text-red-600 text-sm mt-1">Peso deve ser maior que zero</p>
        </template>
      </div>

      <!-- Distância -->
      <div>
        <%= label_tag :distancia, "Distância (km)", class: "block text-sm font-medium text-gray-700" %>
        <%= number_field_tag :distancia, nil, step: 0.1, 
            class: "mt-1 w-full border border-gray-300 rounded px-3 py-2 text-sm shadow-sm",
            x_model: "distancia" %>
        <template x-if="distancia !== '' && distancia <= 0">
          <p class="text-red-600 text-sm mt-1">Distância deve ser maior que zero</p>
        </template>
      </div>

      <!-- Transportador -->
      <div class="md:col-span-2">
        <%= label_tag :transportador_id, "Transportador", class: "block text-sm font-medium text-gray-700" %>
        <%= select_tag :transportador_id,
            options_from_collection_for_select(@transportadores, :id, :nome),
            include_blank: "Selecione um transportador",
            class: "mt-1 w-full border border-gray-300 rounded px-3 py-2 text-sm shadow-sm",
            x_model: "transportador_id" %>
        <template x-if="transportador_id === ''">
          <p class="text-red-600 text-sm mt-1">Selecione um transportador</p>
        </template>
      </div>
    </div>

    <!-- Botão -->
    <div class="mt-6">
      <button
        type="submit"
        class="w-full bg-blue-600 text-white font-semibold px-6 py-3 rounded hover:bg-blue-700 transition disabled:opacity-50"
        :disabled="!valido()"
      >
        Calcular Frete
      </button>
    </div>
  <% end %>

  <% if @valor_estimado.present? %>
    <div class="mt-8 p-6 border rounded-lg bg-gray-50 shadow">
      <h3 class="text-lg font-semibold text-gray-800 mb-2">Resultado da Simulação</h3>
      <p class="text-gray-700 mb-1">
        <strong>Frete estimado:</strong>
        <span class="text-blue-600 font-bold text-xl">R$ <%= @valor_estimado %></span>
      </p>
      <p class="text-sm text-gray-500">
        Valor médio de mercado:
        <span class="text-green-700 font-semibold">R$ <%= @valor_mercado %></span><br>
        (com base em simulação pública ANTT)
      </p>
      <small class="text-xs text-gray-400 mt-2 block">
        Valores estimados não incluem taxas adicionais, pedágios ou seguro.
      </small>
    </div>
  <% end %>
</section>
